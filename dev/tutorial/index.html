<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · SLAM.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SLAM.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Launch-SlamManager-routine"><span>Launch SlamManager routine</span></a></li><li><a class="tocitem" href="#Exit-SLAM"><span>Exit SLAM</span></a></li><li><a class="tocitem" href="#Stereo-mode"><span>Stereo mode</span></a></li><li><a class="tocitem" href="#Synchronizing-threads"><span>Synchronizing threads</span></a></li><li><a class="tocitem" href="#Visualization-and-saving-results"><span>Visualization and saving results</span></a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../api/slam-manager/">Slam Manager</a></li><li><a class="tocitem" href="../api/front-end/">Front-End</a></li><li><a class="tocitem" href="../api/estimator/">Estimator</a></li><li><a class="tocitem" href="../api/map-manager/">Map Manager</a></li><li><a class="tocitem" href="../api/params/">Parameters</a></li><li><a class="tocitem" href="../api/io/">IO</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pxl-th/SLAM.jl/blob/master/docs/src/tutorial.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial"><a class="docs-heading-anchor" href="#Tutorial">Tutorial</a><a id="Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#Tutorial" title="Permalink"></a></h1><h2 id="Launch-SlamManager-routine"><a class="docs-heading-anchor" href="#Launch-SlamManager-routine">Launch SlamManager routine</a><a id="Launch-SlamManager-routine-1"></a><a class="docs-heading-anchor-permalink" href="#Launch-SlamManager-routine" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>There are 3 components in the SLAM.jl that need to run on a separate thread. So, remember to launch Julia with at least <code>-t4</code> flag (+ 1 for the main thread).</p></div></div><p>To launch SLAM algorithm, first we need to set up the <a href="@ref">Camera</a> and <a href="../api/params/#Parameters">Parameters</a>.</p><p>One of the main things you need to specify in parameters is mode (stereo or mono). For other parameters, refer to the documentation, but they all have sane defaults. To improve performance, you can disable local map matching and bundle adjustment using <code>do_local_bundle_adjustment</code> and <code>do_local_matching</code> parameters.</p><pre><code class="language-julia hljs">using SLAM

focal = (910, 910)
resolution = 1024
principal_point = (resolution ÷ 2, resolution ÷ 2)
distortions = (0, 0, 0, 0)

camera = Camera(
    focal..., principal_point..., distortions...,
    resolution, resolution,
)
params = Params(;stereo=false)</code></pre><p>After setting up parameters and camera we can create <a href="../api/slam-manager/#Slam-Manager">Slam Manager</a> and launch its main <a href="../api/slam-manager/#SLAM.run!-Tuple{SlamManager}"><code>run!(::SlamManager)</code></a> routine as a separate thread. Under the hood, <a href="../api/slam-manager/#Slam-Manager">Slam Manager</a> also launches two <code>run!</code> routines for the <a href="../api/estimator/#Estimator">Estimator</a> and <a href="@ref">Mapper</a>.</p><pre><code class="language-julia hljs">manager = SlamManager(camera, params)
manager_thread = Threads.@spawn run!(manager)</code></pre><p>Now you can feed <code>manager</code> with images and its timestamps to track.</p><pre><code class="language-julia hljs">add_image!(manager, image, timestamp)</code></pre><h2 id="Exit-SLAM"><a class="docs-heading-anchor" href="#Exit-SLAM">Exit SLAM</a><a id="Exit-SLAM-1"></a><a class="docs-heading-anchor-permalink" href="#Exit-SLAM" title="Permalink"></a></h2><p>To tell <code>manager</code> that you want to finish its job, set <code>manager.exit_required</code> to <code>true</code> and wait for the thread to finish <code>wait(manager_thread)</code>.</p><h2 id="Stereo-mode"><a class="docs-heading-anchor" href="#Stereo-mode">Stereo mode</a><a id="Stereo-mode-1"></a><a class="docs-heading-anchor-permalink" href="#Stereo-mode" title="Permalink"></a></h2><p>In stereo mode you also need to set right camera. For it, you need to specify transformation matrix that transforms points from the 0-th camera to this (referred as i-th camera) <code>Ti0</code>.</p><pre><code class="language-julia hljs">Ti0 = SMatrix{4, 4, Float64}(...)
right_camera = SLAM.Camera(
    focal..., principal_point..., distortions...,
    resolution, resolution; Ti0)
params = Params(;stereo=true)</code></pre><p>Launch manager, providing right camera:</p><pre><code class="language-julia hljs">manager = SlamManager(camera, params; right_camera)
manager_thread = Threads.@spawn run!(manager)</code></pre><p>In stereo mode, feed images:</p><pre><code class="language-julia hljs">add_stereo_image!(manager, left_image, right_image, timestamp)</code></pre><h2 id="Synchronizing-threads"><a class="docs-heading-anchor" href="#Synchronizing-threads">Synchronizing threads</a><a id="Synchronizing-threads-1"></a><a class="docs-heading-anchor-permalink" href="#Synchronizing-threads" title="Permalink"></a></h2><p>Because different components take different time to run, you need to periodically synchronize them, so that they are roughly processing the same frames and not lagging behind.</p><p>Also because they start their work each in different time and due to JIT compilation, they take different time to compile.</p><p>Dirty way to do this right now is to check length of each of the queue and wait untill they become empty:</p><pre><code class="language-julia hljs">q_size = get_queue_size(slam_manager)
f_size = length(slam_manager.mapper.estimator.frame_queue)
m_size = length(slam_manager.mapper.keyframe_queue)
while q_size &gt; 0 || f_size &gt; 0 || m_size &gt; 0
    sleep(1e-2)
    q_size = get_queue_size(slam_manager)
    f_size = length(slam_manager.mapper.estimator.frame_queue)
    m_size = length(slam_manager.mapper.keyframe_queue)
end</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In future this ideally would not be needed.</p></div></div><h2 id="Visualization-and-saving-results"><a class="docs-heading-anchor" href="#Visualization-and-saving-results">Visualization and saving results</a><a id="Visualization-and-saving-results-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization-and-saving-results" title="Permalink"></a></h2><p>If you want to save all results, you can save <a href="../api/slam-manager/#Slam-Manager">Slam Manager</a> directly as it contains all the processed information.</p><p>If you want to visualize the results as the algorithm runs, use <a href="../api/io/#SLAM.Visualizer"><code>SLAM.Visualizer</code></a> and pass it as keyword to <a href="../api/slam-manager/#Slam-Manager">Slam Manager</a>.</p><pre><code class="language-julia hljs">visualizer = Visualizer((900, 600))
display(visualizer)
manager = SlamManager(params, camera; right_camera, visualizer)</code></pre><p>Otherwise, you can use <a href="../api/io/#SLAM.ReplaySaver"><code>ReplaySaver</code></a> instead of <code>visualizer</code> which will save all the necessary results for later visualization and replay.</p><p>You can see <a href="https://github.com/pxl-th/SLAM.jl/blob/master/example/kitty/main.jl#L84">example/kitty/main.jl</a> for how to use it for visualization.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../api/slam-manager/">Slam Manager »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Friday 22 October 2021 09:20">Friday 22 October 2021</span>. Using Julia version 1.7.0-rc1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
